service: ${file(./slsenv/slsenv.${self:provider.product}.json):NAME}

provider:
  name: aws
  runtime: nodejs8.10
  stage: dev
  product: ${opt:product, 'test'}
  region: us-east-1
  environment:
    NODE_ENV: ${file(./slsenv/slsenv.${self:provider.product}.json):NODE_ENV}
    SWAGGER: ${file(./slsenv/slsenv.${self:provider.product}.json):SWAGGER}
    MONGO: ${file(./slsenv/slsenv.${self:provider.product}.json):MONGO}
    REPLICA: ${file(./slsenv/slsenv.${self:provider.product}.json):REPLICA}
    UEAUTH: ${file(./slsenv/slsenv.${self:provider.product}.json):UEAUTH}
    PRODUCT_SLUG: ${file(./slsenv/slsenv.${self:provider.product}.json):PRODUCT_SLUG}
    S3_KEY: ${file(./slsenv/slsenv.${self:provider.product}.json):S3_KEY}
    S3_SECRET: ${file(./slsenv/slsenv.${self:provider.product}.json):S3_SECRET}
    S3_BUCKET: ${file(./slsenv/slsenv.${self:provider.product}.json):S3_BUCKET}

package:
  exclude:
    - src/**

plugins:
 - serverless-domain-manager

custom:
 customDomain:
   domainName: ${file(./slsenv/slsenv.${self:provider.product}.json):SWAGGER}
   basePath: ''
   stage: ${self:provider.stage}
   createRoute53Record: true

functions:
  app:
    handler: dist/bin/slsapp.handler
    events:
      - http: ANY /
      - http: 'ANY {proxy+}'